# Выравнивание кровати

Выравнивание кровати (иногда также называемое "выравниванием стола") имеет решающее значение для получения высококачественных отпечатков. Если кровать не выровнен должным образом, это может привести к плохой адгезии слоя, "деформации" и незначительным проблемам по всей печати. Этот документ служит руководством по выполнению выравнивания слоя в Klipper.

Важно понимать цель выравнивания ложа. Если во время печати принтеру дается команда занять положение `X0 Y0 Z10`, то цель состоит в том, чтобы сопло принтера находилось на расстоянии ровно 10 мм от печатной формы. Далее, если принтеру будет дана команда перейти в положение `X50 Z10`, то цель состоит в том, чтобы сопло принтера сохраняло точное расстояние в 10 мм от станины в течение всего горизонтального перемещения.

Для получения отпечатков хорошего качества принтер должен быть откалиброван таким образом, чтобы расстояния Z были точными с точностью примерно до 25 микрон (0,025 мм). Это небольшое расстояние - значительно меньше ширины обычного человеческого волоса. Эта шкала не может быть измерена "на глаз". Тонкие эффекты (такие как тепловое расширение) влияют на измерения в этом масштабе. Секрет получения высокой точности заключается в использовании повторяющегося процесса и метода выравнивания, который использует высокую точность собственной системы перемещения принтера.

## Выберите подходящий механизм калибровки

Различные типы принтеров используют разные методы для выполнения выравнивания ложа. Все они в конечном итоге зависят от "бумажного теста" (описанного ниже). Однако фактический процесс для конкретного типа принтера описан в других документах.

Перед запуском любого из этих инструментов калибровки обязательно выполните проверки, описанные в [документе проверки конфигурации](Config_checks.md). Перед выполнением выравнивания слоя необходимо проверить основные движения принтера.

Для принтеров с "автоматическим Z-зондом" обязательно откалибруйте зонд, следуя указаниям в документе [Probe Calibrate](Probe_Calibrate.md). Для дельта-принтеров см. документ [Delta Calibrate](Delta_Calibrate.md). Для принтеров с винтами станины и традиционными концевыми упорами Z см. документ [Manual Level](Manual_Level.md).

Во время калибровки может потребоваться установить для параметра Z принтера `position_min` отрицательное число (например, `position_min = -2`). Принтер обеспечивает проверку границ даже во время процедуры калибровки. Установка отрицательного числа позволяет принтеру двигаться ниже номинального положения станины, что может помочь при попытке определить фактическое положение станины.

## "Бумажный тест"

Основным механизмом калибровки станины является "бумажный тест". Он включает в себя размещение обычного листа "копировальной бумаги" между станиной принтера и соплом, а затем подачу команды соплу на разные высоты Z до тех пор, пока не будет ощущаться небольшое трение при проталкивании бумаги вперед и назад.

Важно понимать "бумажный тест", даже если у вас есть "автоматический Z-зонд". Для получения хороших результатов часто требуется калибровка самого датчика. Калибровка датчика выполняется с помощью этого "бумажного теста".

Для проведения бумажного теста необходимо отрезать ножницами небольшой прямоугольный кусок бумаги (например, 5x3 см). Толщина бумаги обычно составляет около 100 микрон (0,100 мм). (Точная толщина бумаги не имеет принципиального значения.)

Первым шагом проверки бумаги является осмотр сопла и станины принтера. Убедитесь, что на сопле и станине нет пластика (или другого мусора).

**Осмотрите сопло и станину, чтобы убедиться в отсутствии пластика!**

Если вы всегда печатаете на определенной ленте или печатной поверхности, то тест бумаги можно проводить с этой лентой/поверхностью. Однако следует учитывать, что лента сама по себе имеет толщину, и разные ленты (или любые другие поверхности для печати) будут влиять на результаты измерений Z. Обязательно повторите тест на бумаге для измерения каждого типа используемой поверхности.

Если на сопле остался пластик, нагрейте экструдер и удалите его металлическим пинцетом. Подождите, пока экструдер полностью остынет до комнатной температуры, прежде чем продолжить тест бумаги. Пока насадка остывает, удалите металлическим пинцетом пластик, который может вытечь.

**Всегда проводите тест бумаги, когда сопло и станина находятся при комнатной температуре!**

При нагреве сопла его положение (относительно станины) изменяется за счет теплового расширения. Это тепловое расширение обычно составляет около 100 мкм, т.е. примерно столько же, сколько толщина обычного листа бумаги для принтера. Точная величина теплового расширения не имеет принципиального значения, так же как и точная толщина бумаги. Начните с предположения, что эти два параметра равны (метод определения разницы между этими двумя расстояниями см. ниже).

Может показаться странным калибровать расстояние при комнатной температуре, когда цель - получить постоянное расстояние при нагревании. Однако, если калибровать при нагретом сопле, то на бумагу попадает небольшое количество расплавленного пластика, что изменяет величину ощущаемого трения. Это затрудняет получение хорошей калибровки. Калибровка при горячем ложе/сопле также значительно повышает риск обжечься. Величина теплового расширения стабильна, поэтому ее легко учесть позже в процессе калибровки.

**Используйте автоматизированный инструмент для точного определения высоты Z!**

В Klipper есть несколько вспомогательных скриптов (например, MANUAL_PROBE, Z_ENDSTOP_CALIBRATE, PROBE_CALIBRATE, DELTA_CALIBRATE). Чтобы выбрать один из них, смотрите документы [описанные выше](#choose-the-appropriate-calibration-mechanism).

Запустите соответствующую команду в окне терминала OctoPrint. Сценарий запросит взаимодействие с пользователем в выводе терминала OctoPrint. Это будет выглядеть примерно так:

```
Recv: // Запуск ручного Z-зонда. Используйте TESTZ для настройки положения.
Recv: // Завершение работы командой ACCEPT или ABORT.
Recv: // Положение по оси Z: ?????? --> 5.000 <-- ??????
```

Текущая высота сопла (как ее понимает принтер в данный момент) отображается между символами "--> <--". Число справа - это высота последней попытки зонда чуть больше текущей высоты, а слева - последняя попытка зонда меньше текущей высоты (или ??????, если попыток не было).

Поместите бумагу между соплом и станиной. Может быть полезно загнуть угол бумаги, чтобы ее было легче захватить. (Старайтесь не давить на станину при перемещении бумаги вперед-назад.)

![paper-test](img/paper-test.jpg)

Используйте команду TESTZ, чтобы запросить перемещение сопла ближе к бумаге. Например:

```
TESTZ Z=-.1
```

Команда TESTZ переместит сопло на относительное расстояние от текущего положения сопла. (Так, `Z=-.1` просит сопло переместиться ближе к станине на .1 мм.) После того, как сопло перестанет двигаться, подтолкните бумагу вперед-назад, чтобы проверить, соприкасается ли сопло с бумагой, и почувствовать трение. Продолжайте подавать команды TESTZ, пока не почувствуете небольшое трение при тестировании с бумагой.

Если обнаружено слишком большое трение, то можно использовать положительное значение Z для перемещения сопла вверх. Также можно использовать команду `TESTZ Z=+` или `TESTZ Z=-` для "биссекции" последнего положения, т.е. для перемещения в положение, находящееся на полпути между двумя положениями. Например, если в результате выполнения команды TESTZ был получен следующий запрос:

```
Recv: // Положение по Z: 0.130 --> 0.230 <-- 0.280
```

Тогда команда `TESTZ Z=-` переместит сопло в положение Z, равное 0,180 (половина пути между 0,130 и 0,230). Эту функцию можно использовать для быстрого сужения диапазона трения. Также можно использовать команды `Z=++` и `Z=--` для возврата непосредственно к прошлому измерению - например, после приведенного выше запроса команда `TESTZ Z=--` переместит сопло в положение по оси Z, равное 0,130.

После обнаружения небольшого трения выполните команду ACCEPT:

```
ПРИНЯТЬ
```

При этом принимается заданная высота Z и выполняется калибровка с помощью заданного инструмента.

Точная величина ощущаемого трения не имеет решающего значения, так же как не имеет значения величина теплового расширения и точная ширина бумаги. Просто старайтесь добиться одинаковой величины трения при каждом испытании.

Если в процессе тестирования что-то пошло не так, то для выхода из программы калибровки можно воспользоваться командой `ABORT`.

## Определение температурного расширения

После успешного выполнения выравнивания станины можно перейти к расчету более точного значения совместного влияния "теплового расширения", "толщины бумаги" и "величины трения, ощущаемого при испытании бумаги".

Этот тип расчетов обычно не требуется, поскольку большинство пользователей считают, что простой "бумажный тест" дает хорошие результаты.

Самый простой способ выполнить этот расчет - распечатать тестовый объект, имеющий прямые стенки со всех сторон. Для этого можно использовать большой полый квадрат, находящийся в [docs/prints/square.stl](prints/square.stl). При нарезке объекта убедитесь, что для первого уровня слайсер использует ту же высоту слоя и ширину выдавливания, что и для всех последующих слоев. Используйте грубую высоту слоя (высота слоя должна составлять около 75% диаметра сопла) и не используйте обводку или плот.

Напечатайте тестовый объект, подождите, пока он остынет, и снимите его со стола. Осмотрите самый нижний слой объекта. (Если нижний слой немного выпуклый со всех сторон, то это означает, что сопло было расположено немного ближе к слою, чем должно быть. Для увеличения высоты можно подать команду `SET_GCODE_OFFSET Z=+.010`. В последующих отпечатках можно проконтролировать такое поведение и при необходимости произвести дальнейшую настройку. Регулировки такого типа обычно выражаются в десятках микрон (.010 мм).

Если нижний слой постоянно оказывается более узким, чем последующие, то можно воспользоваться командой SET_GCODE_OFFSET для отрицательной корректировки по Z. Если нет уверенности, то можно уменьшить корректировку по Z до появления небольшой выпуклости нижнего слоя отпечатков, а затем отступить до ее исчезновения.

Самый простой способ применить нужную корректировку по Z - создать макрос g-кода START_PRINT, организовать вызов этого макроса слайсером в начале каждой печати и добавить в этот макрос команду SET_GCODE_OFFSET. Более подробная информация приведена в документе [slicers](Slicers.md).
