# Расстояние поворота

Драйверы шаговых двигателей на Klipper требуют параметра `rotation_distance` в каждом [разделе конфигурации шагового двигателя](Config_Reference.md #stepper). `rotation_distance` это величина расстояния, на которое перемещается ось за один полный оборот шагового двигателя. В этом документе описано, как можно настроить это значение.

## Получение rotation_distance из steps_per_mm (или step_distance)

Разработчики вашего 3d-принтера изначально рассчитали `steps_per_mm` исходя из расстояния поворота. Если вы знаете steps_per_mm, то можно использовать эту общую формулу для получения этого исходного расстояния поворота:

```
rotation_distance = <полные_шаги_пер_ротации>* <микрошаги> / <шаги_пер_мм>
```

Или, если у вас более старая конфигурация Klipper и вы знаете параметр `step_distance`, вы можете использовать эту формулу:

```
rotation_distance = <полные_шаги_пере_ротации> * <микрошаги> * <шаг_дистанция>
```

Настройка `<full_steps_per_rotation` определяется типом шагового двигателя. Большинство шаговых двигателей являются "шаговиками 1,8 градуса" и поэтому имеют 200 полных шагов на оборот (360 разделить на 1,8 - 200). Некоторые шаговые двигатели - это "шаговые двигатели 0,9 градуса", поэтому они имеют 400 полных шагов на оборот. Другие шаговые двигатели встречаются редко. Если вы не уверены, не задавайте значение full_steps_per_rotation в конфигурационном файле и используйте 200 в приведенной выше формуле.

Настройка `<microsteps>` определяется драйвером шагового двигателя. Большинство драйверов используют 16 микрошагов. Если вы не уверены, установите `microsteps: 16` в конфигурации и используйте 16 в приведенной выше формуле.

Почти у всех принтеров должно быть целое число для `rotation_distance` по осям типа X, Y и Z. Если приведенная выше формула приводит к rotation_distance, которое находится в пределах .01 от целого числа, то округлите конечное значение до этого whole_number.

## Калибровка rotation_distance на экструдерах

В экструдере `rotation_distance` - это величина расстояния, которое проходит нить накала за один полный оборот шагового двигателя. Лучший способ получить точное значение для этого параметра - использовать процедуру "измерить и обрезать".

Сначала начните с первоначального предположения о расстоянии поворота. Это может быть получено с помощью [steps_per_mm](#получение-rotation_distance-из-steps_per_mm-или-step_distance) или с помощью [проверки оборудования](#экструдер).

Затем используйте следующую процедуру для "измерения и обрезки":

1. Убедитесь, что в экструдере есть нить накала, горячий конец нагрет до соответствующей температуры и принтер готов к выдавливанию.
1. Используйте маркер, чтобы сделать отметку на нити примерно в 70 мм от входного отверстия корпуса экструдера. Затем с помощью цифрового штангенциркуля измерьте фактическое расстояние до этой отметки настолько точно, насколько это возможно. Обратите внимание на это как на `<initial_mark_distance>`.
1. Выдавите 50 мм нити накала, используя следующую последовательность команд: "G91", за которой следует `G1 E50 F60`. Обратите внимание на 50 мм как на "<запрошенное_extrude_distance>". Дождитесь завершения работы экструдера (это займет около 50 секунд). Для этого теста важно использовать медленную скорость экструзии, так как более высокая скорость может вызвать высокое давление в экструдере, что исказит результаты. (Не используйте кнопку "выдавливать" на графических интерфейсах для этого теста, так как они выдавливаются с высокой скоростью.)
1. С помощью цифрового штангенциркуля измерьте новое расстояние между корпусом экструдера и меткой на нити накала. Обратите внимание на это как на `<subscribent_mark_distance>`. Затем вычислите: `actual_extrude_distance = <initial_mark_distance> - <subscribent_mark_distance>`
1. Вычислить значение rotation_distance следующим образом: `значение rotation_distance = <предыдущее значение rotation_distance> * <фактическое значение extrude_distance> / <запрошенное значение extrude_distance>` Округлите новое значение rotation_distance до трех знаков после запятой.

Если фактическое значение extrude_distance отличается от запрошенного значения extrude_distance более чем примерно на 2 мм, то рекомендуется выполнить описанные выше действия во второй раз.

Примечание: *Не используйте* метод типа "измерение и обрезка" для калибровки осей типа x, y или z. Метод "измерения и обрезки" недостаточно точен для этих осей и, скорее всего, приведет к ухудшению конфигурации. Вместо этого, при необходимости, эти оси могут быть определены с помощью [измерения ремней, шкивов и ходового винта](#получение-расстояния-вращения-путем-проверки-оборудования).

## Получение rotation_distance путем проверки аппаратного обеспечения

Можно рассчитать rotation_distance, зная шаговые двигатели и кинематику принтера. Это может быть полезно, если steps_per_mm неизвестен или при разработке нового принтера.

### Оси с ременным приводом

Легко рассчитать rotation_distance для линейной оси, использующей ремень и шкив.

Сначала определитесь с типом ремня. Большинство принтеров используют шаг ленты 2 мм (то есть каждый зуб на ленте находится на расстоянии 2 мм друг от друга). Затем подсчитайте количество зубьев на шкиве шагового двигателя. Затем значение rotation_distance вычисляется как:

```
rotation_distance = <belt_pitch> * <число_зубов_на_пульке>
```

Например, если принтер оснащен ремнем диаметром 2 мм и использует шкив с 20 зубьями, то расстояние поворота равно 40.

### Оси с ходовым винтом

Легко рассчитать расстояние поворота для обычных ходовых винтов, используя следующую формулу:

```
rotation_distance = <винтовой переключатель> * <количество_ отдельных нитей>
```

Например, обычный "ходовой винт T8" имеет расстояние поворота 8 (он имеет шаг 2 мм и имеет 4 отдельные резьбы).

Старые принтеры с "резьбовыми стержнями" имеют только одну "резьбу" на ходовом винте, и, таким образом, расстояние поворота равно шагу винта. (Шаг винта - это расстояние между каждой канавкой на винте.) Так, например, метрический стержень M6 имеет расстояние поворота, равное 1, а стержень M8 имеет расстояние поворота, равное 1,25.

### Экструдер

Начальное расстояние вращения для экструдеров можно получить, измерив диаметр "зубчатого болта", который проталкивает нить, и используя следующую формулу: `rotation_distance = <диаметр> * 3,14`

Если в экструдере используются шестерни, то также необходимо будет [определить и установить gear_ratio](#using-a-gear_ratio) для экструдера.

Фактическое расстояние вращения экструдера будет варьироваться от принтера к принтеру, поскольку захват "зубчатого болта", который захватывает нить накала, может варьироваться. Она может варьироваться даже в зависимости от катушки с нитью накала. После получения начального значения rotation_distance используйте [процедуру измерения и обрезки](#калибровка-rotation_distance-на-экструдерах) для получения более точной настройки.

## Использование gear_ratio

Установка `gear_ratio` может упростить настройку `rotation_distance` на степперах, к которым подключена коробка передач (или что-то подобное). У большинства степперов нет коробки передач - если вы не уверены, то не устанавливайте `gear_ratio` в конфигурации.

Когда задано значение `gear_ratio`, значение `rotation_distance` представляет расстояние, на которое перемещается ось при одном полном обороте последней передачи коробки передач. Если, например, используется коробка передач с передаточным отношением "5:1", то можно было бы рассчитать rotation_distance с помощью [знания аппаратного обеспечения](#получение-rotation_distance-путем-проверки-аппаратного обеспечения), а затем добавить `gear_ratio: 5:1` в конфигурацию.

Для зубчатой передачи, реализованной с помощью ремней и шкивов, можно определить соотношение зубьев путем подсчета зубьев на шкивах. Например, если шаговый двигатель с 16-зубчатым шкивом приводит в движение следующий шкив с 80 зубьями, то можно было бы использовать `gear_ratio: 80:16`. Действительно, можно было бы открыть обычную "коробку передач" и сосчитать зубья в ней, чтобы подтвердить ее передаточное отношение.

Обратите внимание, что иногда коробка передач будет иметь несколько иное передаточное отношение, чем то, как она рекламируется. Примером этого являются обычные мотор-редукторы экструдеров BMG - они рекламируются как "3:1", но на самом деле используют передачу "50:17". (Использование номеров зубьев без общего знаменателя может улучшить общий износ зубчатого колеса, поскольку зубья не всегда входят в зацепление одинаково при каждом обороте.) Обычная планетарная коробка передач "5.18:1" более точно сконфигурирована с помощью `gear_ratio: 57:11`.

Если на оси используется несколько зубчатых колес, то в gear_ratio можно указать список, разделенный запятыми. Например, коробка передач "5:1", приводящая в движение шкив с 16 зубьями на 80 зубьев, может использовать `gear_ratio: 5:1, 80:16`.

В большинстве случаев gear_ratio следует определять целыми числами, поскольку обычные шестерни и шкивы имеют на себе целое число зубьев. Однако в случаях, когда ремень приводит в движение шкив, используя трение вместо зубьев, может иметь смысл использовать число с плавающей запятой в передаточном отношении (например, `gear_ratio: 107.237:16`).
