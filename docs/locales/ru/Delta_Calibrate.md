# Дельта-калибровка

В этом документе описывается система автоматической калибровки Klipper для принтеров типа "delta".

Дельта-калибровка включает в себя определение положений концевых упоров башни, углов башни, дельта-радиуса и длины дельта-рычагов. Эти настройки управляют перемещением принтера на принтере delta. Каждый из этих параметров оказывает неочевидное и нелинейное влияние, и их трудно откалибровать вручную. Напротив, программный код калибровки может обеспечить отличные результаты всего за несколько минут. Никакого специального зондирующего оборудования не требуется.

В конечном счете, дельта-калибровка зависит от точности концевых выключателей башни. Если вы используете драйверы шаговых двигателей Trinamic, то рассмотрите возможность включения [endstop phase](Endstop_Phase.md) обнаружения для повышения точности этих переключателей.

## Автоматическое и ручное зондирование

Klipper поддерживает калибровку дельта-параметров с помощью ручного метода измерения или с помощью автоматического Z-зонда.

Некоторые комплекты дельта-принтеров поставляются с автоматическими Z-зондами, которые не обладают достаточной точностью (в частности, небольшая разница в длине может вызвать наклон эффектора, что может исказить показания автоматического датчика). Если используется автоматический датчик, то сначала необходимо откалибровать датчик [calibrate the probe](Probe_Calibrate.md), а затем проверить смещение положения датчика [probe location bias](Probe_Calibrate.md#location-bias-check). Если смещение автоматического датчика превышает 25 микрон (.025 мм), то вместо этого используйте ручное зондирование. Ручное зондирование занимает всего несколько минут и устраняет погрешность, вносимую зондом.

Если используется датчик, установленный сбоку от хотэнда (т.е. имеющий смещение по оси X или Y), то следует учитывать, что при выполнении дельта-калибровки результаты калибровки датчика будут недействительными. Такие датчики редко подходят для дельта-калибровки (поскольку незначительный наклон эффектора приведет к смещению положения датчика). Если датчик все же используется, то после выполнения дельта-калибровки обязательно выполните повторную калибровку датчика.

## Базовая дельта-калибровка

В Klipper есть команда DELTA_CALIBRATE, которая может выполнять базовую дельта-калибровку. Эта команда исследует семь различных точек на станине и вычисляет новые значения для углов башни, торцевых поверхностей башни и радиуса дельты.

Для выполнения этой калибровки необходимо указать начальные дельта-параметры (длины рычагов, радиус и положения конечных упоров), и они должны иметь точность с точностью до нескольких миллиметров. Большинство комплектов принтеров delta предоставляют эти параметры - настройте принтер с этими начальными значениями по умолчанию, а затем выполните команду DELTA_CALIBRATE, как описано ниже. Если значения по умолчанию недоступны, найдите в Интернете руководство по дельта-калибровке, которое может послужить базовой отправной точкой.

В процессе дельта-калибровки принтеру может потребоваться провести зондирование ниже того, что в противном случае считалось бы плоскостью подложки. Обычно это разрешается во время калибровки путем обновления конфигурации таким образом, чтобы `minimum_z_position принтера=-5`. (После завершения калибровки можно удалить эту настройку из конфигурации.)

Существует два способа выполнения зондирования - ручное зондирование (`DELTA_CALIBRATE METHOD=manual`) и автоматическое зондирование (`DELTA_CALIBRATE`). Метод ручного зондирования позволяет приблизить головку к подложке, а затем дождаться, пока пользователь выполнит шаги, описанные в ["тест бумаги"](Bed_Level.md#the-paper-test), чтобы определить фактическое расстояние между насадкой и подложкой в заданном месте.

Чтобы выполнить базовую проверку, убедитесь, что в конфигурации определен раздел [delta_calibrate], а затем запустите инструмент:

```
G28
DELTA_CALIBRATE METHOD=ручной
```

После зондирования семи точек будут рассчитаны новые дельта-параметры. Сохраните и примените эти параметры, выполнив:

```
SAVE_CONFIG
```

Базовая калибровка должна обеспечивать дельта-параметры, достаточные для базовой печати. Если это новый принтер, сейчас самое подходящее время напечатать некоторые базовые объекты и проверить общую функциональность.

## Улучшенная дельта-калибровка

Базовая дельта-калибровка, как правило, хорошо справляется с вычислением дельта-параметров таким образом, чтобы сопло находилось на правильном расстоянии от слоя. Однако он не пытается откалибровать точность размеров X и Y. Рекомендуется выполнить расширенную дельта-калибровку для проверки точности размеров.

Эта процедура калибровки требует распечатки тестируемого объекта и измерения частей этого тестируемого объекта цифровыми штангенциркулями.

Перед запуском расширенной дельта калибровки необходимо запустить базовую дельта-калибровку (с помощью команды DELTA_CALIBRATE) и сохранить результаты (с помощью команды SAVE_CONFIG). Убедитесь, что с момента последнего выполнения базовой дельта-калибровки не произошло каких-либо заметных изменений ни в конфигурации принтера, ни в оборудовании (если вы не уверены, повторно запустите [базовую дельта калибровку](#basic-delta-калибровка), включая SAVE_CONFIG, непосредственно перед печатью. тестовый объект, описанный ниже.)

Используйте слайсер для генерации G-кода из файла [docs/prints/calibrate_size.style](prints/calibrate_size.stl). Нарежьте объект, используя медленную скорость (например, 40 мм/с). Если возможно, используйте для этого предмета жесткий пластик (например, PLA). Объект имеет диаметр 140 мм. Если он слишком велик для принтера, то можно уменьшить его масштаб (но обязательно равномерно масштабируйте обе оси X и Y). Если принтер поддерживает печать значительно большего размера, то этот объект также можно увеличить в размере. Больший размер может повысить точность измерений, но хорошая адгезия к отпечатку важнее, чем больший размер отпечатка.

Распечатайте тестовый объект и подождите, пока он полностью остынет. Команды, описанные ниже, должны выполняться с теми же настройками принтера, которые использовались для печати объекта калибровки (не запускайте DELTA_CALIBRATE между печатью и измерением и не делайте ничего, что в противном случае изменило бы конфигурацию принтера).

Если возможно, выполните измерения, описанные ниже, пока объект все еще прикреплен к подложке для печати, но не волнуйтесь, если деталь отсоединится от подложки - просто старайтесь избегать изгиба объекта при выполнении измерений.

Начните с измерения расстояния между центральной стойкой и стойкой рядом с надписью "А" (которая также должна быть направлена в сторону башни "А").

![дельта-расстояние](img/delta-a-distance.jpg )

Затем поверните против часовой стрелки и измерьте расстояния между центральной стойкой и другими стойками (расстояние от центра до стойки напротив метки C, расстояние от центра до стойки с меткой B и т.д.).

![delta_cal_e_step1](img/delta_cal_e_step1.png)

Введите эти параметры в Klipper со списком чисел с плавающей запятой, разделенных запятыми:

```
DELTA_ANALYZE CENTER_DISTS=<a_dist>,<far_c_dist>,<b_dist>,<far_a_dist>,<c_dist>,<far_b_dist>
```

Укажите значения без пробелов между ними.

Затем измерьте расстояние между стойкой A и стойкой напротив метки C.

![дельта-ав-расстояние](img/delta-outer-distance.jpg )

Затем поверните против часовой стрелки и измерьте расстояние между стойкой напротив от C до стойки B, расстояние между стойкой B и стойкой напротив A и так далее.

![delta_cal_e_step2](img/delta_cal_e_step2.png)

Введите эти параметры в Klipper:

```
DELTA_ANALYZE OUTER_DISTS=<a_to_far_c>,<far_c_to_b>,<b_to_far_a>,<far_a_to_c>,<c_to_far_b>,<far_b_to_a>
```

На этом этапе можно убрать предмет с кровати. Окончательные измерения производятся для самих колонн. Измерьте размер центральной стойки вдоль спицы A, затем спицы B, а затем спицы C.

![delta-a-pillar](img/delta-a-pillar.jpg)

![delta_cal_e_step3](img/delta_cal_e_step3.png)

Введите их в Klipper:

```
DELTA_ANALYZE CENTER_PILLAR_WIDTHS=<a>,<b>,<c>
```

Окончательные измерения производятся для внешних опор. Начните с измерения расстояния от столба A по линии от A до столба напротив C.

![delta-ab-pillar](img/delta-outer-pillar.jpg)

Затем идите против часовой стрелки и измерьте оставшиеся внешние стойки (стойка напротив C вдоль линии до B, стойка B вдоль линии до стойки напротив A и т.д.).

![delta_cal_e_step4](img/delta_cal_e_step4.png)

И введите их в Klipper:

```
DELTA_ANALYZE OUTER_PILLAR_WIDTHS=<a>,<far_c>,<b>,<far_a>,<c>,<far_b>
```

Если объект был масштабирован до меньшего или большего размера, укажите коэффициент масштабирования, который использовался при нарезке объекта:

```
ШКАЛА DELTA_ANALYZE=1.0
```

(Значение масштаба, равное 2,0, означало бы, что объект в два раза больше своего первоначального размера, 0,5 - это половина его первоначального размера.)

Наконец, выполните расширенную дельта-калибровку, запустив:

```
DELTA_ANALYZE CALIBRATE=расширенный
```

Выполнение этой команды может занять несколько минут. После завершения он рассчитает обновленные дельта-параметры (радиус дельты, углы наклона башни, положения концевых упоров и длины рычагов). Используйте команду SAVE_CONFIG, чтобы сохранить и применить настройки:

```
SAVE_CONFIG
```

Команда SAVE_CONFIG сохранит как обновленные дельта-параметры, так и информацию, полученную в результате измерений расстояния. Будущие команды DELTA_CALIBRATE также будут использовать эту информацию о расстоянии. Не пытайтесь повторно ввести необработанные измерения расстояния после запуска SAVE_CONFIG, так как эта команда изменяет конфигурацию принтера и необработанные измерения больше не применяются.

### Дополнительные примечания

* Если принтер delta обладает хорошей точностью размеров, то расстояние между любыми двумя стойками должно составлять около 74 мм, а ширина каждой стойки - около 9 мм. (В частности, цель состоит в том, чтобы расстояние между любыми двумя стойками за вычетом ширины одной из стоек составляло ровно 65 мм.) Если в детали имеется неточность в размерах, то процедура DELTA_ANALYZE вычислит новые дельта-параметры, используя как измерения расстояния, так и предыдущие измерения высоты из последней команды DELTA_CALIBRATE.
* DELTA_ANALYZE может выдавать неожиданные дельта-параметры. Например, в нем может быть указана длина рычагов, которая не соответствует фактической длине рычагов принтера. Несмотря на это, тестирование показало, что DELTA_ANALYZE часто дает превосходные результаты. Считается, что вычисленные дельта-параметры способны учитывать незначительные ошибки в других частях аппаратного обеспечения. Например, небольшие различия в длине руки могут привести к наклону исполнительного устройства, и часть этого наклона может быть учтена путем регулировки параметров длины руки.

## Использование сетки Bed Mesh в дельте

Можно использовать [сетку для кровати](Bed_Mesh.md ) на дельте. Однако важно получить хорошую дельта-калибровку перед включением сетки слоя. Использование сетки слоя с плохой дельта-калибровкой приведет к путанице и плохим результатам.

Обратите внимание, что выполнение дельта-калибровки сделает недействительной любую ранее полученную сетку пласта. После выполнения новой дельта-калибровки обязательно повторно запустите BED_MESH_CALIBRATE.
