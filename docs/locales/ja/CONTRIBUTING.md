# Klipper に貢献する

Klipperに貢献していただき、ありがとうございます! このドキュメントでは、Klipper の変更に貢献するためのプロセスについて説明します。

問題の報告や開発者への連絡については、[問い合わせ先](Contact.md)をご覧ください。

## 貢献プロセスの概要 {#overview-of-contribution-process}

Klipper への貢献は、一般的にハイレベルなプロセスに従います：

1. 提出者は、提出物が広範な展開に適していると判断した時点で、[GitHub のプルリクエスト](https://github.com/Klipper3d/klipper/pulls)を作成します。
1. [レビュアー](#reviewers)が提出物のレビューを行う準備ができたら、GitHub上のそのプルリクエストに自身を割り当てます。レビューの目的は、欠陥を見つけることと、提出物が文書化されたガイドラインに従っていることを確認することです。
1. レビューが成功すると、レビュアーは GitHub 上で "レビューを承認" し、[メンテナー](#reviewers) がその変更を Klipper の master ブランチにコミットします。

機能拡張に取り組む際には、[Klipper Discourse](Contact.md) でトピックを立ち上げる (または、トピックに貢献する) ことを検討してください。フォーラムでの継続的な議論は、開発作業の可視性を向上させ、新しい作業のテストに興味を持つ他の人たちを惹きつけるかもしれません。

## レビューで期待されること {#what-to-expect-in-a-review}

Klipperへの投稿は、マージする前にレビューされます。レビューの主な目的は、欠陥のチェックと、投稿がKlipperのドキュメントで指定されているガイドラインに従っているかどうかをチェックすることです。

課題をするための方法は多岐にわたることが理解されています。レビューの目的は "最良の" 実装を議論することではありません。可能な限り、事実と計測に基づくレビューの議論が好ましいです。

ほとんどの提出物はレビューからフィードバックが得られるでしょう。フィードバックを受け入れ、さらなる詳細を提供し、必要に応じて提出物を更新する準備をしておいてください。

レビュアーが注意を払う一般的な点：


   1. 提出されたものに欠陥はなく、広く展開される準備ができていますか?提出者は提出前に変更をテストすることが期待されています。レビュアーはエラーを探しますが、一般的には投稿をテストすることはありません。受理された提出物は、多くの場合、受理から数週間以内に何千ものプリンタに展開されます。そのため、提出物の品質が優先されます。

   メインの[Klipper3d/klipper](https://github.com/Klipper3d/klipper) GitHubリポジトリでは、実験的な作業は受け付けていません。提出者は自分のリポジトリで実験、デバッグ、テストを行うべきです。 [Klipper Discourse](Contact.md) サーバーは新しい作業を周知し、実世界のフィードバックを提供する興味を持つユーザーを見つけるための良い場所です。

   提出物はすべての[回帰テスト](Debugging.md)ケースをパスする必要があります。

   コード内の欠陥を修正する際には、提出者はその欠陥の根本原因を把握しておく必要があり、修正はその根本原因に焦点を当てるべきです。

   コードの提出物には過剰なデバッグコード、デバッグオプション、実行時のデバッグログは含めないでください。

   コード提出時のコメントは、コードの保守性を高めることに重点を置いてください。提出されたコードには、"コメントアウトされたコード" や、過去の実装を説明する過剰なコメントを含めるべきではありません。過剰な "todo" コメントを含めてはいけません。

   ドキュメントの更新は "進行中の作業" と宣言してはいけません。

   1. 提出物は、実世界のユーザーが実際のタスクを実行する際に "インパクトの大きい" 利益をもたらすか？レビュアーは、少なくとも自分自身の中で、おおよその "対象ユーザー層" 、そのユーザー層の "おおよその規模" 、得られる "利益" 、その"利益の計測方法"、および "その計測テストの結果" を特定する必要があります。ほとんどの場合、これは提出者とレビュアーの両者にとって明白であり、レビュー中に明示されることはありません。

   Klipper の master ブランチへの提出物は、注目すべきターゲット層を持つことが期待されます。一般的な "おおよその目安" として、提出物は少なくとも100人の実際のユーザーを対象とするべきです。

   もしレビュアーが提出物の "利益" に関する詳細を求める場合、それを批判とは考えないでください。変更がもたらす実世界での利益を理解するように務めることは、レビューの一環であり、自然なことです。

   利益について議論する際には、"事実と計測" に基づく議論が好ましいです。一般的に、レビュアーは "誰かがオプションXを有用と考えるかもしれない" といった形式の回答を求めているわけではありませんし、また "この提出物はファームウェアXが実装する機能を追加する" といった形式の回答も求めていません。代わりに、品質改善の計測方法やその計測結果の詳細について議論する方が一般的に望ましいです。例えば、"Acme X1000プリンタでのテストは、写真で見るようにコーナーの改善が見られる" といった内容や、"Foomatic X900プリンタ上での実際のオブジェクトXの印刷時間は4時間から3.5時間に短縮された" といった内容です。この種のテストにはかなりの時間と労力がかかることをご理解ください。いくつかのKlipperの注目すべき機能は、master ブランチにマージされる前に、数ヶ月にわたる議論、改良、テスト、文書化が行われました。

   すべての新しいモジュール、設定オプション、コマンド、コマンドパラメータ、およびドキュメントは "インパクトが大きい" ものであるべきです。私たちはユーザーが理に適った設定ができないオプションでユーザに負担をかけたくありませんし、注目すべき利益を提供しないオプションでユーザーに負担をかけたくありません。

   レビュアーは、ユーザーがオプションをどのように設定するかについての説明を求める場合があります。 理想的な回答は、プロセスの詳細を含むものです。 例: "MegaX500のユーザーはオプションXを99.3に設定することを期待しており、Elite100Yのユーザーは手順...を使用してオプションXをキャリブレーションすることを期待しています..."

   もしオプションの目標がコードをよりモジュール化することであるなら、ユーザー向けの設定オプションの代わりにコード定数の使用を優先してください。

   新しいモジュール、新しいオプション、および新しいパラメータは、既存のモジュールと類似の機能を提供すべきではありません。もし違いが恣意的である場合、既存のシステムを活用するか、既存のコードをリファクタリングすることが望ましいです。

   1. 提出物の著作権は明確で無償であり、ライセンスに互換性がありますか？新しいCファイルとPythonファイルには、明確な著作権表記が必要です。望ましい形式については、既存のファイルを参照してください。既存のファイルにわずかな変更を加えるときに、そのファイルに著作権を宣言することは推奨されません。

   サードパーティのソースから取得したコードは、Klipper のライセンス (GNU GPLv3) と互換性がなければなりません。大規模なサードパーティのコードの追加は、 `lib/` ディレクトリに追加してください (そして、[lib/README](../lib/README) に記述されているフォーマットに従ってください)。

   投稿者は、[Signed-off-by 行](#format-of-commit-messages) に自分の完全な実名を記入しなければなりません。これは、投稿者が [developer certificate of origin](developer-certificate-of-origin) に同意していることを示すものです。

   1. 提出物は、Klipper のドキュメントで指定されているガイドラインに従っていますか?特に、コードは [Code_Overview.md](Code_Overview.md) のガイドラインに従うべきであり、設定ファイルは [Example_Configs.md](Example_Configs.md) のガイドラインに従うべきです。

   1. Klipper のドキュメントは、新しい変更を反映して更新されていますか?少なくとも、リファレンス・ドキュメントはコードの変更に対応して更新されなければなりません:

   * すべてのコマンドとコマンド・パラメーターは [G-Codes.md](G-Codes.md) に文書化されていなければなりません。
   * すべてのユーザー向けモジュールとその設定パラメータは、[Config_Reference.md](Config_Reference.md) に文書化されていなければなりません。
   * エクスポートされた "ステータス変数" はすべて[Status_Reference.md](Status_Reference.md) に文書化されなければなりません。
   * すべての新しい "webhooks "とそのパラメータは、[API_Server.md](API_Server.md) に文書化されなければなりません。
   * コマンドやConfigファイルの設定に後方互換性のない変更を加える場合は、[Config_Changes.md](Config_Changes.md) に文書化しなければなりません。

新しいドキュメントは [Overview.md](Overview.md) に追加し、ウェブサイトのインデックス [docs/_klipper3d/mkdocs.yml](../docs/_klipper3d/mkdocs.yml) に追加してください。


   1. コミットは適切に形成され、1つのコミットにつき1つのトピックに取り組み、独立していますか?コミットメッセージは[望ましいフォーマット](#format-of-commit-messages)に従うべきです。

   コミットにはマージでの競合があってはなりません。Klipper の master ブランチへの新規追加は常に "revase" または "squash and rebase" によって行われます。通常、提出者がKlipperのmaster リポジトリを更新するたびに再度マージする必要はありません。ただし、マージの競合が発生する場合、提出者は競合を解消するために `git rebase ` を使用することを推奨します。

   各コミットは1つの高レベルな変更に取り組むべきです。大きな変更は複数の独立したコミットに分割するべきです。各コミットは "単独で成立する" ようにすることで、 `git bisect ` や `git revert ` のようなツールが期待通りに動作するようにするべきです。

   空白の変更と機能の変更は混在させないでください。一般的に、不必要な空白の変更は、修正されるコードの確立された "所有者" からのものでない限り受け入れられません。

Klipper では、厳密な "コーディング・スタイル・ガイド" を導入していませんが、既存のコードを修正する場合は、その既存コードのハイレベルなコードフロー、コードのインデントスタイル、フォーマットに従う必要があります。新しいモジュールやシステムの提出は、コーディングスタイルにおいてより柔軟性がありますが、新しいコードが内部的に一貫したスタイルに従うこと、そして一般的な業界のコーディング規範に従うことが望ましいです。

"より良い実装" について議論することは、レビューの目標ではありません。ただし、レビュアーが提出物の実装を理解するのに苦労する場合、実装の透明性を高めるための変更を求めることがあります。特に、レビュアーが提出物に欠陥がないと確信を持てない場合、変更が必要になる可能性があります。

レビューの一環として、レビュアーはトピックに対して代わりのプルリクエストを作成することがあります。これは、細かな手続き上の項目での過度なやり取りを避け、提出プロセスを効率化するために行われることがあります。また、議論がレビュアーに別の実装を考えさせることがあるため、このようなことも行われるかもしれません。どちらの状況もレビューの正常な結果であり、元の提出物への批判とは考えるべきではありません。

### レビューの支援 {#helping-with-reviews}

レビューへの協力は大歓迎です！ レビューを行うには、指定された[レビューア](#reviewers) である必要はありません。GitHubのプルリクエストの提出者も、自身の提出物をレビューすることが推奨されていています。

レビューを支援するためには、[レビューで期待されること](#what-to-expect-in-a-review) に示された手順に従って提出物を検証してください。レビューを完了した後、GitHubプルリクエストにコメントを追加して結果を報告してください。提出物がレビューをパスした場合、コメントで明示的にそのことを述べてください。例えば、"CONTRIBUTINGドキュメントの手順に従ってこの変更をレビューし、すべてが問題ないように見えます" といった内容です。レビューの一部の手順を完了できなかった場合は、どの手順をレビューしたか、どの手順をレビューしていないかを明示的に述べてください。例えば、"コードの欠陥はチェックしていませんが、CONTRIBUTINGドキュメントの他の部分はレビューし、問題ないように見えます" といった内容です。

提出物のテストも大変ありがたく思います。もしコードがテストされた場合は、GitHubプルリクエストにテスト結果を記載するコメントを追加してください - 成功または失敗に関わらず。コードがテストされたことと、その結果を明示的に述べてください - 例えば、 "このコードをAcme900Zプリンタで花瓶の印刷をテストしました。結果は良好でした" といった内容です。

### レビュアー {#reviewers}

Klipper のレビュアー:

| 名前 | GitHub Id | 関心領域 |
| --- | --- | --- |
| Dmitry Butyugin | @dmbutyugin | Input shaping, 共振テスト, 運動学 |
| Eric Callahan | @Arksine | ベッドレベリング, MCUフラッシュ |
| James Hartley | @JamesH1978 | Config ファイル |
| Kevin O'Connor | @KevinOConnor | コアモーションシステム, マイコン用のコード |

レビュアーのどなたにも直接メッセージを送ったり提出物を送ることはご遠慮ください。すべてのレビュアーがフォーラムとプルリクエストを監視しており、時間がある時にレビューを行います。

Klipper のメンテナ:

| 名前 | Git Hub 名 |
| --- | --- |
| Kevin O'Connor | @KevinOConnor |

## コミットメッセージのフォーマット {#format-of-commit-messages}

各コミットには、以下のような形式のコミット・メッセージが必要です：

```
module: Capitalized, short (50 chars or less) summary

More detailed explanatory text, if necessary.  Wrap it to about 75
characters or so.  In some contexts, the first line is treated as the
subject of an email and the rest of the text as the body.  The blank
line separating the summary from the body is critical (unless you omit
the body entirely); tools like rebase can get confused if you run the
two together.

Further paragraphs come after blank lines..

Signed-off-by: My Name <myemail@example.org>
```

上記の例では、`module` はリポジトリ内のファイル名またはディレクトリ名（拡張子なし）でなければなりません。例: `clocksync: Fix typo in pause() call at connect time`. コミットメッセージにモジュール名を明記する目的は、コミットにコンテキストを提供するためです。

各コミットには "Signed-off-by" の行を追加することが重要です。これにより、[developer certificate of origin](developer-certificate-of-origin)に同意したことが確認されます。その行には、本名（疑名や匿名の寄稿はご遠慮ください）と現在のメールアドレスを含める必要があります。

## Klipperの翻訳に貢献する {#contributing-to-klipper-translations}

[Klipper-translationsプロジェクト](https://github.com/Klipper3d/klipper-translations) は、Klipperをさまざまな言語に翻訳するためのプロジェクトです。[Weblate](https://hosted.weblate.org/projects/klipper/)は、翻訳とレビューのためのすべてのGettext文字列をホストしています。ロケールは、[klipper3d.org](https://www.klipper3d.org) で、以下の条件を満たせば表示することができます：

- [ ] 75% の合計カバー率
- [ ] すべてのタイトル（H1）が翻訳されていること
- [ ] klipper-translations における更新されたナビゲーション階層のプルリクエスト

ドメイン固有の用語を翻訳するフラストレーションを軽減し、進行中の翻訳を認識するために、[Klipper-translations Project](https://github.com/Klipper3d/klipper-translations) の `readme.md` を修正するプルリクエストを送ることができます。翻訳の準備が整えば、Klipper プロジェクトを修正することができます。

もしKlipperリポジトリ内に既に翻訳が存在し、上記のチェックリストに当てはまらなくなった場合、更新がないまま1ヶ月が経過すると、その翻訳は out-of-date とマークされます。

要件を満たしたら次のことが必要です :

1. klipper-tranlations リポジトリの [active_translations](https://github.com/Klipper3d/klipper-translations/blob/translations/active_translations) を更新
1. オプション: klipper-translations リポジトリの `docs\locals\<lang>` フォルダに、言語固有の index.md を置き換えるための manual-index.md ファイルを追加してください (生成された index.md は正しくレンダリングされません)。

既知の問題:

1. 現在のところ、ドキュメント内の画像を正しく翻訳する方法はありません。
1. mkdocs.yml のタイトルを翻訳することはできません。
